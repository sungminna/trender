pg_database:
  query: "SELECT pg_database.datname, pg_database_size(pg_database.datname) as size_bytes FROM pg_database"
  master: true
  cache_seconds: 30
  metrics:
    - datname:
        usage: "LABEL"
        description: "Name of the database"
    - size_bytes:
        usage: "GAUGE"
        description: "Disk space used by the database"

pg_stat_user_tables:
  query: |
    SELECT
      current_database() datname,
      schemaname,
      tablename,
      seq_scan,
      seq_tup_read,
      idx_scan,
      idx_tup_fetch,
      n_tup_ins,
      n_tup_upd,
      n_tup_del,
      n_tup_hot_upd,
      n_live_tup,
      n_dead_tup,
      n_mod_since_analyze,
      COALESCE(last_vacuum, '1970-01-01Z') as last_vacuum,
      COALESCE(last_autovacuum, '1970-01-01Z') as last_autovacuum,
      COALESCE(last_analyze, '1970-01-01Z') as last_analyze,
      COALESCE(last_autoanalyze, '1970-01-01Z') as last_autoanalyze,
      vacuum_count,
      autovacuum_count,
      analyze_count,
      autoanalyze_count
    FROM pg_stat_user_tables
  master: true
  cache_seconds: 30
  metrics:
    - datname:
        usage: "LABEL"
        description: "Name of the database"
    - schemaname:
        usage: "LABEL"
        description: "Name of the schema"
    - tablename:
        usage: "LABEL"
        description: "Name of the table"
    - seq_scan:
        usage: "COUNTER"
        description: "Number of sequential scans initiated on this table"
    - seq_tup_read:
        usage: "COUNTER"
        description: "Number of live rows fetched by sequential scans"
    - idx_scan:
        usage: "COUNTER"
        description: "Number of index scans initiated on this table"
    - idx_tup_fetch:
        usage: "COUNTER"
        description: "Number of live rows fetched by index scans"
    - n_tup_ins:
        usage: "COUNTER"
        description: "Number of rows inserted"
    - n_tup_upd:
        usage: "COUNTER"
        description: "Number of rows updated"
    - n_tup_del:
        usage: "COUNTER"
        description: "Number of rows deleted"
    - n_tup_hot_upd:
        usage: "COUNTER"
        description: "Number of rows HOT updated"
    - n_live_tup:
        usage: "GAUGE"
        description: "Estimated number of live rows"
    - n_dead_tup:
        usage: "GAUGE"
        description: "Estimated number of dead rows"
    - n_mod_since_analyze:
        usage: "GAUGE"
        description: "Estimated number of rows changed since last analyze"
    - last_vacuum:
        usage: "GAUGE"
        description: "Last time at which this table was manually vacuumed"
    - last_autovacuum:
        usage: "GAUGE"
        description: "Last time at which this table was vacuumed by the autovacuum daemon"
    - last_analyze:
        usage: "GAUGE"
        description: "Last time at which this table was manually analyzed"
    - last_autoanalyze:
        usage: "GAUGE"
        description: "Last time at which this table was analyzed by the autovacuum daemon"
    - vacuum_count:
        usage: "COUNTER"
        description: "Number of times this table has been manually vacuumed"
    - autovacuum_count:
        usage: "COUNTER"
        description: "Number of times this table has been vacuumed by the autovacuum daemon"
    - analyze_count:
        usage: "COUNTER"
        description: "Number of times this table has been manually analyzed"
    - autoanalyze_count:
        usage: "COUNTER"
        description: "Number of times this table has been analyzed by the autovacuum daemon"

# LGraph 애플리케이션 특화 메트릭
lgraph_podcast_tasks:
  query: |
    SELECT 
      status,
      COUNT(*) as count,
      AVG(EXTRACT(EPOCH FROM (updated_at - created_at))) as avg_duration_seconds,
      MAX(EXTRACT(EPOCH FROM (updated_at - created_at))) as max_duration_seconds
    FROM podcast_tasks 
    WHERE created_at > NOW() - INTERVAL '24 hours'
    GROUP BY status
  master: true
  cache_seconds: 60
  metrics:
    - status:
        usage: "LABEL"
        description: "Status of podcast task"
    - count:
        usage: "GAUGE"
        description: "Number of podcast tasks by status in last 24h"
    - avg_duration_seconds:
        usage: "GAUGE"
        description: "Average duration of podcast tasks by status"
    - max_duration_seconds:
        usage: "GAUGE"
        description: "Maximum duration of podcast tasks by status"

lgraph_agent_results:
  query: |
    SELECT 
      agent_name,
      COUNT(*) as count,
      AVG(EXTRACT(EPOCH FROM (updated_at - created_at))) as avg_execution_seconds
    FROM agent_results 
    WHERE created_at > NOW() - INTERVAL '24 hours'
    GROUP BY agent_name
  master: true
  cache_seconds: 60
  metrics:
    - agent_name:
        usage: "LABEL"
        description: "Name of the agent"
    - count:
        usage: "GAUGE"
        description: "Number of agent executions in last 24h"
    - avg_execution_seconds:
        usage: "GAUGE"
        description: "Average execution time of agent"

lgraph_tts_results:
  query: |
    SELECT 
      status,
      COUNT(*) as count,
      AVG(audio_duration) as avg_audio_duration,
      SUM(audio_duration) as total_audio_duration
    FROM tts_results 
    WHERE created_at > NOW() - INTERVAL '24 hours'
    GROUP BY status
  master: true
  cache_seconds: 60
  metrics:
    - status:
        usage: "LABEL"
        description: "Status of TTS result"
    - count:
        usage: "GAUGE"
        description: "Number of TTS results by status in last 24h"
    - avg_audio_duration:
        usage: "GAUGE"
        description: "Average audio duration in seconds"
    - total_audio_duration:
        usage: "GAUGE"
        description: "Total audio duration in seconds"

pg_settings:
  query: |
    SELECT
      name,
      setting,
      unit
    FROM pg_settings
    WHERE name IN (
      'max_connections',
      'shared_buffers',
      'effective_cache_size',
      'maintenance_work_mem',
      'checkpoint_completion_target',
      'wal_buffers',
      'default_statistics_target',
      'random_page_cost',
      'effective_io_concurrency',
      'work_mem',
      'min_wal_size',
      'max_wal_size'
    )
  master: true
  cache_seconds: 600
  metrics:
    - name:
        usage: "LABEL"
        description: "Configuration parameter name"
    - setting:
        usage: "GAUGE"
        description: "Configuration parameter value"
    - unit:
        usage: "LABEL"
        description: "Configuration parameter unit" 